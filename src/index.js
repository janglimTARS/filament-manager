// This file is auto-generated by build.js
const HTML_CONTENT = "<!DOCTYPE html>\n<html lang=\"en\" class=\"dark\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>Filament Manager</title>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <script>\n    tailwind.config = {\n      theme: {\n        extend: {\n          colors: {\n            base: '#0f172a',\n            card: '#1e293b',\n            border: '#334155'\n          }\n        }\n      }\n    }\n  </script>\n  <link rel=\"stylesheet\" href=\"/styles.css\" />\n</head>\n<body class=\"bg-base text-slate-100 min-h-screen font-sans\">\n  <div class=\"max-w-6xl mx-auto p-4 sm:p-6 space-y-4\">\n    <header class=\"rounded-2xl border border-border bg-card p-4 sm:p-6\">\n      <div class=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 class=\"text-2xl sm:text-3xl font-semibold\">Filament Inventory Manager</h1>\n          <p class=\"text-slate-400 mt-1\">Track filament spools, stock levels, and usage estimates.</p>\n        </div>\n        <button id=\"addSpoolBtn\" class=\"btn-primary\">+ Add Spool</button>\n      </div>\n    </header>\n\n    <section class=\"grid grid-cols-2 lg:grid-cols-4 gap-3\" id=\"statsGrid\"></section>\n\n    <section class=\"rounded-2xl border border-border bg-card p-4\">\n      <div class=\"grid grid-cols-1 md:grid-cols-4 gap-3\">\n        <input id=\"searchInput\" class=\"input md:col-span-2\" placeholder=\"Search brand, color, notes, location...\" />\n        <select id=\"materialFilter\" class=\"input\"></select>\n        <select id=\"brandFilter\" class=\"input\"></select>\n      </div>\n      <div class=\"flex flex-wrap gap-3 mt-3\">\n        <button id=\"exportBtn\" class=\"btn-secondary\">Export JSON</button>\n        <label class=\"btn-secondary cursor-pointer\">\n          Import JSON\n          <input type=\"file\" id=\"importInput\" accept=\"application/json\" class=\"hidden\" />\n        </label>\n      </div>\n    </section>\n\n    <section class=\"rounded-2xl border border-border bg-card p-4\">\n      <h2 class=\"text-lg font-semibold mb-3\">Inventory</h2>\n      <div id=\"spoolList\" class=\"space-y-3\"></div>\n      <div id=\"emptyState\" class=\"hidden text-center py-10 text-slate-400\">\n        <p class=\"text-lg\">No filament yet.</p>\n        <p>Add your first spool to get started.</p>\n      </div>\n    </section>\n\n    <section class=\"rounded-2xl border border-border bg-card p-4 space-y-3\">\n      <h2 class=\"text-lg font-semibold\">Printer (Bambu P1S Stub)</h2>\n      <div class=\"grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm\">\n        <div class=\"chip\"><span>Status:</span><strong id=\"printerStatus\">Disconnected</strong></div>\n        <div class=\"chip\"><span>Nozzle:</span><strong>-- °C</strong></div>\n        <div class=\"chip\"><span>Bed:</span><strong>-- °C</strong></div>\n      </div>\n      <div class=\"chip text-sm\"><span>Current Job:</span><strong>None</strong></div>\n      <button id=\"configurePrinterBtn\" class=\"btn-secondary\">Configure Printer</button>\n    </section>\n  </div>\n\n  <dialog id=\"spoolModal\" class=\"modal\">\n    <form id=\"spoolForm\" class=\"rounded-2xl border border-border bg-card p-4 sm:p-5 w-[92vw] max-w-2xl text-slate-100 space-y-3\">\n      <div class=\"flex items-center justify-between\">\n        <h3 id=\"modalTitle\" class=\"text-xl font-semibold\">Add Spool</h3>\n        <button type=\"button\" id=\"closeModalBtn\" class=\"text-slate-400 hover:text-white\">✕</button>\n      </div>\n      <input type=\"hidden\" id=\"spoolId\" />\n      <div class=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n        <input id=\"brand\" class=\"input\" placeholder=\"Brand\" required />\n        <input id=\"colorName\" class=\"input\" placeholder=\"Color name (e.g. Matte Black)\" required />\n        <input id=\"colorHex\" type=\"color\" class=\"input h-11 p-1\" value=\"#ffffff\" />\n        <select id=\"material\" class=\"input\" required>\n          <option>PLA</option><option>PETG</option><option>ABS</option><option>TPU</option><option>ASA</option><option>Other</option>\n        </select>\n        <input id=\"diameter\" class=\"input\" type=\"number\" step=\"0.01\" value=\"1.75\" required />\n        <input id=\"location\" class=\"input\" placeholder=\"Storage location / box\" />\n        <input id=\"totalWeight\" class=\"input\" type=\"number\" min=\"1\" placeholder=\"Total weight (g)\" required />\n        <input id=\"remainingWeight\" class=\"input\" type=\"number\" min=\"0\" placeholder=\"Remaining (g)\" required />\n        <input id=\"purchaseDate\" class=\"input\" type=\"date\" />\n        <input id=\"cost\" class=\"input\" type=\"number\" step=\"0.01\" min=\"0\" placeholder=\"Cost ($)\" />\n      </div>\n      <textarea id=\"notes\" class=\"input min-h-24\" placeholder=\"Notes\"></textarea>\n      <button class=\"btn-primary w-full\" type=\"submit\">Save Spool</button>\n    </form>\n  </dialog>\n\n  <dialog id=\"printerModal\" class=\"modal\">\n    <form id=\"printerForm\" class=\"rounded-2xl border border-border bg-card p-4 w-[92vw] max-w-md space-y-3 text-slate-100\">\n      <h3 class=\"text-xl font-semibold\">Configure Printer</h3>\n      <input id=\"printerIp\" class=\"input\" placeholder=\"Printer IP (e.g. 192.168.1.50)\" required />\n      <input id=\"printerToken\" class=\"input\" placeholder=\"Access token\" required />\n      <div class=\"flex gap-2\">\n        <button class=\"btn-primary flex-1\" type=\"submit\">Save</button>\n        <button class=\"btn-secondary flex-1\" type=\"button\" id=\"closePrinterModalBtn\">Cancel</button>\n      </div>\n    </form>\n  </dialog>\n\n  <script src=\"/app.js\"></script>\n</body>\n</html>\n";
const JS_CONTENT = "const STORAGE_KEY = 'filament-manager-spools';\nconst PRINTER_KEY = 'filament-manager-printer';\nconst MATERIAL_DENSITY = { PLA: 1.24, PETG: 1.27, ABS: 1.04, TPU: 1.21, ASA: 1.07, Other: 1.2 };\n\nlet spools = loadSpools();\nlet currentEditId = null;\n\nconst els = {\n  statsGrid: document.getElementById('statsGrid'),\n  spoolList: document.getElementById('spoolList'),\n  emptyState: document.getElementById('emptyState'),\n  searchInput: document.getElementById('searchInput'),\n  materialFilter: document.getElementById('materialFilter'),\n  brandFilter: document.getElementById('brandFilter'),\n  spoolModal: document.getElementById('spoolModal'),\n  spoolForm: document.getElementById('spoolForm'),\n  modalTitle: document.getElementById('modalTitle'),\n  printerModal: document.getElementById('printerModal'),\n};\n\ninit();\n\nfunction init() {\n  bindEvents();\n  populateFilters();\n  loadPrinterConfig();\n  render();\n}\n\nfunction bindEvents() {\n  document.getElementById('addSpoolBtn').onclick = () => openSpoolModal();\n  document.getElementById('closeModalBtn').onclick = () => els.spoolModal.close();\n  document.getElementById('configurePrinterBtn').onclick = () => openPrinterModal();\n  document.getElementById('closePrinterModalBtn').onclick = () => els.printerModal.close();\n  document.getElementById('exportBtn').onclick = exportJson;\n  document.getElementById('importInput').onchange = importJson;\n\n  els.searchInput.oninput = render;\n  els.materialFilter.onchange = render;\n  els.brandFilter.onchange = render;\n\n  els.spoolForm.onsubmit = onSubmitSpool;\n  document.getElementById('printerForm').onsubmit = onSavePrinter;\n}\n\nfunction loadSpools() {\n  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }\n  catch { return []; }\n}\nfunction saveSpools() { localStorage.setItem(STORAGE_KEY, JSON.stringify(spools)); }\n\nfunction openSpoolModal(spool = null) {\n  currentEditId = spool?.id || null;\n  els.modalTitle.textContent = spool ? 'Edit Spool' : 'Add Spool';\n  const set = (id, val = '') => document.getElementById(id).value = val;\n\n  set('spoolId', spool?.id || '');\n  set('brand', spool?.brand || '');\n  set('colorName', spool?.colorName || '');\n  set('colorHex', spool?.colorHex || '#ffffff');\n  set('material', spool?.material || 'PLA');\n  set('diameter', spool?.diameter || 1.75);\n  set('location', spool?.location || '');\n  set('totalWeight', spool?.totalWeight || '');\n  set('remainingWeight', spool?.remainingWeight || '');\n  set('purchaseDate', spool?.purchaseDate || '');\n  set('cost', spool?.cost || '');\n  set('notes', spool?.notes || '');\n  els.spoolModal.showModal();\n}\n\nfunction onSubmitSpool(e) {\n  e.preventDefault();\n  const data = {\n    id: currentEditId || crypto.randomUUID(),\n    brand: v('brand'), colorName: v('colorName'), colorHex: v('colorHex'),\n    material: v('material'), diameter: Number(v('diameter')) || 1.75,\n    totalWeight: Number(v('totalWeight')), remainingWeight: Number(v('remainingWeight')),\n    location: v('location'), purchaseDate: v('purchaseDate'), cost: Number(v('cost')) || 0,\n    notes: v('notes'),\n  };\n\n  if (data.remainingWeight > data.totalWeight) {\n    alert('Remaining weight cannot be greater than total weight.');\n    return;\n  }\n\n  const i = spools.findIndex(s => s.id === data.id);\n  if (i >= 0) spools[i] = data; else spools.unshift(data);\n  saveSpools();\n  populateFilters();\n  els.spoolModal.close();\n  render();\n}\n\nfunction v(id) { return document.getElementById(id).value.trim(); }\n\nfunction deleteSpool(id) {\n  if (!confirm('Delete this spool? This cannot be undone.')) return;\n  spools = spools.filter(s => s.id !== id);\n  saveSpools();\n  populateFilters();\n  render();\n}\n\nfunction getFiltered() {\n  const q = els.searchInput.value.toLowerCase();\n  const material = els.materialFilter.value;\n  const brand = els.brandFilter.value;\n\n  return spools.filter(s => {\n    const matchesMaterial = material === 'All materials' || s.material === material;\n    const matchesBrand = brand === 'All brands' || s.brand === brand;\n    const searchable = Object.values(s).join(' ').toLowerCase();\n    const matchesSearch = !q || searchable.includes(q);\n    return matchesMaterial && matchesBrand && matchesSearch;\n  });\n}\n\nfunction render() {\n  const data = getFiltered();\n  renderStats();\n  els.spoolList.innerHTML = data.map(spoolCard).join('');\n  els.emptyState.classList.toggle('hidden', data.length !== 0);\n\n  data.forEach(s => {\n    document.getElementById(`edit-${s.id}`)?.addEventListener('click', () => openSpoolModal(s));\n    document.getElementById(`delete-${s.id}`)?.addEventListener('click', () => deleteSpool(s.id));\n  });\n}\n\nfunction spoolCard(s) {\n  const pct = s.totalWeight ? (s.remainingWeight / s.totalWeight) * 100 : 0;\n  const low = pct < 20;\n  const lengthM = estimateLengthMeters(s.remainingWeight, s.material, s.diameter);\n\n  return `<div class=\"card ${low ? 'low-stock' : ''}\">\n    <div class=\"flex items-start justify-between gap-2\">\n      <div class=\"space-y-1\">\n        <div class=\"flex items-center gap-2\"><span class=\"swatch\" style=\"background:${s.colorHex}\"></span><h3 class=\"font-semibold\">${escapeHtml(s.brand)} — ${escapeHtml(s.colorName)}</h3></div>\n        <p class=\"text-sm text-slate-400\">${s.material} • ${s.diameter}mm • ${escapeHtml(s.location || 'No location')}</p>\n      </div>\n      <div class=\"text-right text-sm\">\n        <p class=\"${low ? 'text-amber-400 font-semibold' : 'text-slate-300'}\">${Math.round(s.remainingWeight)}g / ${Math.round(s.totalWeight)}g</p>\n        <p class=\"text-slate-500\">~${lengthM.toFixed(1)}m left</p>\n      </div>\n    </div>\n    <div class=\"mt-2 w-full bg-slate-800 rounded-full h-2\"><div class=\"h-2 rounded-full ${low ? 'bg-amber-400' : 'bg-cyan-400'}\" style=\"width:${Math.max(0, Math.min(100, pct))}%\"></div></div>\n    <div class=\"mt-2 text-sm text-slate-400 flex flex-wrap gap-4\">\n      <span>Purchased: ${s.purchaseDate || '—'}</span>\n      <span>Cost: $${(s.cost || 0).toFixed(2)}</span>\n      ${s.notes ? `<span>Notes: ${escapeHtml(s.notes)}</span>` : ''}\n    </div>\n    <div class=\"mt-3 flex gap-2\">\n      <button id=\"edit-${s.id}\" class=\"btn-secondary\">Edit</button>\n      <button id=\"delete-${s.id}\" class=\"btn-secondary\">Delete</button>\n    </div>\n  </div>`;\n}\n\nfunction estimateLengthMeters(weightG, material, diameterMm) {\n  const density = MATERIAL_DENSITY[material] || MATERIAL_DENSITY.Other; // g/cm3\n  const dCm = (diameterMm || 1.75) / 10;\n  const area = Math.PI * (dCm / 2) ** 2;\n  const volumeCm3 = weightG / density;\n  const lengthCm = volumeCm3 / area;\n  return lengthCm / 100;\n}\n\nfunction renderStats() {\n  const totalSpools = spools.length;\n  const totalWeight = spools.reduce((a, s) => a + (s.remainingWeight || 0), 0);\n  const totalValue = spools.reduce((a, s) => a + (s.cost || 0), 0);\n  const byMaterial = spools.reduce((acc, s) => {\n    acc[s.material] = (acc[s.material] || 0) + (s.remainingWeight || 0);\n    return acc;\n  }, {});\n\n  const materialSummary = Object.entries(byMaterial).map(([k, v]) => `${k}: ${Math.round(v)}g`).join(' • ') || 'No data';\n  els.statsGrid.innerHTML = `\n    <div class=\"card\"><p class=\"text-slate-400 text-sm\">Total Spools</p><p class=\"text-2xl font-semibold\">${totalSpools}</p></div>\n    <div class=\"card\"><p class=\"text-slate-400 text-sm\">Total Remaining</p><p class=\"text-2xl font-semibold\">${Math.round(totalWeight)}g</p></div>\n    <div class=\"card\"><p class=\"text-slate-400 text-sm\">Estimated Value</p><p class=\"text-2xl font-semibold\">$${totalValue.toFixed(2)}</p></div>\n    <div class=\"card\"><p class=\"text-slate-400 text-sm\">By Material</p><p class=\"text-sm\">${materialSummary}</p></div>\n  `;\n}\n\nfunction populateFilters() {\n  const materials = ['All materials', ...new Set(spools.map(s => s.material))];\n  const brands = ['All brands', ...new Set(spools.map(s => s.brand))];\n  fillSelect(els.materialFilter, materials);\n  fillSelect(els.brandFilter, brands);\n}\nfunction fillSelect(el, options) {\n  const current = el.value;\n  el.innerHTML = options.map(o => `<option>${o}</option>`).join('');\n  if (options.includes(current)) el.value = current;\n}\n\nfunction exportJson() {\n  const payload = JSON.stringify({ exportedAt: new Date().toISOString(), spools }, null, 2);\n  const blob = new Blob([payload], { type: 'application/json' });\n  const a = document.createElement('a');\n  a.href = URL.createObjectURL(blob);\n  a.download = 'filament-inventory.json';\n  a.click();\n  URL.revokeObjectURL(a.href);\n}\n\nfunction importJson(e) {\n  const file = e.target.files[0];\n  if (!file) return;\n  const r = new FileReader();\n  r.onload = () => {\n    try {\n      const parsed = JSON.parse(r.result);\n      const incoming = Array.isArray(parsed) ? parsed : parsed.spools;\n      if (!Array.isArray(incoming)) throw new Error('Invalid format');\n      spools = incoming;\n      saveSpools();\n      populateFilters();\n      render();\n      alert('Import successful.');\n    } catch {\n      alert('Invalid JSON file.');\n    }\n  };\n  r.readAsText(file);\n  e.target.value = '';\n}\n\nfunction openPrinterModal() {\n  const data = JSON.parse(localStorage.getItem(PRINTER_KEY) || '{}');\n  document.getElementById('printerIp').value = data.ip || '';\n  document.getElementById('printerToken').value = data.token || '';\n  els.printerModal.showModal();\n}\n\nfunction onSavePrinter(e) {\n  e.preventDefault();\n  const config = { ip: v('printerIp'), token: v('printerToken') };\n  localStorage.setItem(PRINTER_KEY, JSON.stringify(config));\n  els.printerModal.close();\n  loadPrinterConfig();\n}\n\nfunction loadPrinterConfig() {\n  const data = JSON.parse(localStorage.getItem(PRINTER_KEY) || '{}');\n  document.getElementById('printerStatus').textContent = data.ip ? `Configured (${data.ip})` : 'Disconnected';\n}\n\nfunction escapeHtml(str='') {\n  return str.replace(/[&<>'\\\"]/g, c => ({ '&':'&amp;','<':'&lt;','>':'&gt;',\"'\":'&#39;','\"':'&quot;' }[c]));\n}\n";
const CSS_CONTENT = ":root { color-scheme: dark; }\nbody { background: #0f172a; }\n\n.btn-primary {\n  border-radius: 0.75rem;\n  background: #06b6d4;\n  color: #0f172a;\n  font-weight: 600;\n  padding: 0.5rem 1rem;\n  transition: 0.2s ease;\n}\n.btn-primary:hover { background: #22d3ee; }\n\n.btn-secondary {\n  border-radius: 0.75rem;\n  border: 1px solid #475569;\n  background: rgba(30, 41, 59, 0.7);\n  color: #e2e8f0;\n  padding: 0.5rem 1rem;\n  transition: 0.2s ease;\n}\n.btn-secondary:hover { border-color: #94a3b8; }\n\n.input {\n  border-radius: 0.75rem;\n  border: 1px solid #475569;\n  background: rgba(15, 23, 42, 0.8);\n  color: #f1f5f9;\n  padding: 0.5rem 0.75rem;\n}\n.input:focus {\n  outline: none;\n  border-color: #22d3ee;\n  box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.2);\n}\n\n.card {\n  border-radius: 1rem;\n  border: 1px solid #334155;\n  background: rgba(15, 23, 42, 0.45);\n  padding: 0.75rem;\n}\n\n.chip {\n  border-radius: 0.75rem;\n  border: 1px solid #334155;\n  background: rgba(15, 23, 42, 0.45);\n  padding: 0.5rem 0.75rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n}\n\n.modal { background: transparent; border: none; padding: 0; }\n.modal::backdrop { background: rgba(2, 6, 23, 0.75); }\n\n.swatch {\n  width: 18px;\n  height: 18px;\n  border-radius: 999px;\n  border: 1px solid rgba(255,255,255,0.35);\n}\n\n.low-stock {\n  border-color: #f59e0b !important;\n  box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.4) inset;\n}\n";

export default {
  async fetch(request, env, ctx) {
    const url = new URL(request.url);

    // Serve the HTML page
    if (url.pathname === '/' || url.pathname === '/index.html') {
      return new Response(HTML_CONTENT, {
        headers: {
          'Content-Type': 'text/html;charset=UTF-8',
        },
      });
    }

    // Serve the JavaScript file
    if (url.pathname === '/app.js') {
      return new Response(JS_CONTENT, {
        headers: {
          'Content-Type': 'application/javascript',
        },
      });
    }

    // Serve the CSS file
    if (url.pathname === '/styles.css') {
      return new Response(CSS_CONTENT, {
        headers: {
          'Content-Type': 'text/css;charset=UTF-8',
        },
      });
    }

    return new Response('Not Found', { status: 404 });
  },
};
